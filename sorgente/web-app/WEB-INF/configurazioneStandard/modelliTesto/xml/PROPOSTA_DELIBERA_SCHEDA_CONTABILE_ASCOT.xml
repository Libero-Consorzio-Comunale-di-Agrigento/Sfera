<?xml version="1.0" encoding="utf-8"?>
<documentRoot>
		<descrizione>Proposta di Delibera (Contabilità Sfera)</descrizione>
	<connections>
		<connectionJNDI>jdbc/agsde2</connectionJNDI>
	</connections>
	<testStaticData>
		<documentRoot>
			<proposta_delibera>
				<ANNO_PROPOSTA>2014</ANNO_PROPOSTA>
				<NUMERO_PROPOSTA>10</NUMERO_PROPOSTA>
				<OGGETTO>PROPOSTA DI DELIBERA</OGGETTO>
				<OGGETTO_DEFINITIVO>PROPOSTA DI DELIBERA  - OGGETTO DEFINITIVO</OGGETTO_DEFINITIVO>
				<CLASSIFICA_CODICE>01</CLASSIFICA_CODICE>
				<CLASSIFICA_DESCRIZIONE>DESCRIZIONE TITOLARIO</CLASSIFICA_DESCRIZIONE>
				<FASCICOLO_ANNO>2014</FASCICOLO_ANNO>
				<FASCICOLO_NUMERO>100</FASCICOLO_NUMERO>
				<FASCICOLO_OGGETTO>DESCRIZIONE FASCICOLO</FASCICOLO_OGGETTO>
				<FUNZIONARIO>NOMINATIVO FUNZIONARIO</FUNZIONARIO>
				<DIRIGENTE>TRABUCCHI LAURA</DIRIGENTE>
				<UNITA_PROPONENTE>AREA AFFARI GENERALI</UNITA_PROPONENTE>
				<UNITA_PADRE>AREA AMMINISTRATIVA</UNITA_PADRE>
				<CODICE_UNITA_PROPONENTE>A_AAGG</CODICE_UNITA_PROPONENTE>
				<AREA_PROPONENTE>AFFARI GENERALI</AREA_PROPONENTE>
				<SERVIZIO_PROPONENTE>SEGRETERIA</SERVIZIO_PROPONENTE>						
				<SUDDIVISIONE>AREA</SUDDIVISIONE>
				<FIRMATARIO>NOMINATIVO FIRMATARIO</FIRMATARIO>
				<DESCRIZIONE_FIRMATARIO>Il funzionario delegato</DESCRIZIONE_FIRMATARIO>
              	<DELEGANTE>(IN SOSTITUZIONE DI QUALCUNO)</DELEGANTE>
				<DATA_FIRMA>01/05/2014</DATA_FIRMA>
				<COGNOME_RELATORE>COGNOME RELATORE</COGNOME_RELATORE>
				<NOME_RELATORE>NOME RELATORE</NOME_RELATORE>
				<RELATORE>NOMINATIVO RELATORE</RELATORE>
				<M_TOTALE_ENTRATE>205,33</M_TOTALE_ENTRATE>
				<M_TOTALE_USCITE>133,00</M_TOTALE_USCITE>
				<MSE>+</MSE>
				<MSU>-</MSU>
				<REDATTORE>NOMINATIVO REDATTORE</REDATTORE>
				<DESCRIZIONE_RADICE_SUDD>RADICE AFFARI GENERALI</DESCRIZIONE_RADICE_SUDD>
			</proposta_delibera>
			<movimenti>
				<M_TIPO>MOVI</M_TIPO>
				<M_ESERCIZIO>2015</M_ESERCIZIO>
				<M_PROGRESSIVO_ESTERNO>1</M_PROGRESSIVO_ESTERNO>
				<M_CAPITOLO>4</M_CAPITOLO>
				<M_ENTRATA>ENTRATA</M_ENTRATA>
				<M_CIG>13123</M_CIG>
				<M_ESERIZIO_PROVENIENZA>2015</M_ESERIZIO_PROVENIENZA>
				<M_IMPORTO>1234,00</M_IMPORTO>
				<M_NUMERO_MOVIMENTO>1</M_NUMERO_MOVIMENTO>
				<M_DATA_MOVIMENTO>01/01/2015</M_DATA_MOVIMENTO>
				<M_CODICE_PDCF>3</M_CODICE_PDCF>
				<M_DESCRIZIONE_PDCF>descrizione pdcf</M_DESCRIZIONE_PDCF>
			</movimenti>
			<movimenti>
				<M_TIPO>MOVI</M_TIPO>
				<M_ESERCIZIO>2015</M_ESERCIZIO>
				<M_PROGRESSIVO_ESTERNO>1</M_PROGRESSIVO_ESTERNO>
				<M_CAPITOLO>4</M_CAPITOLO>
				<M_ENTRATA>ENTRATA</M_ENTRATA>
				<M_CIG>13123</M_CIG>
				<M_ESERIZIO_PROVENIENZA>2015</M_ESERIZIO_PROVENIENZA>
				<M_IMPORTO>1234,00</M_IMPORTO>
				<M_NUMERO_MOVIMENTO>2</M_NUMERO_MOVIMENTO>
				<M_DATA_MOVIMENTO>01/01/2015</M_DATA_MOVIMENTO>
				<M_CODICE_PDCF>3</M_CODICE_PDCF>
				<M_DESCRIZIONE_PDCF>descrizione pdcf</M_DESCRIZIONE_PDCF>
			</movimenti>
			<movimenti>
				<M_TIPO>MOVI</M_TIPO>
				<M_ESERCIZIO>2015</M_ESERCIZIO>
				<M_PROGRESSIVO_ESTERNO>1</M_PROGRESSIVO_ESTERNO>
				<M_CAPITOLO>4</M_CAPITOLO>
				<M_ENTRATA>ENTRATA</M_ENTRATA>
				<M_CIG>13123</M_CIG>
				<M_ESERIZIO_PROVENIENZA>2015</M_ESERIZIO_PROVENIENZA>
				<M_IMPORTO>1234,00</M_IMPORTO>
				<M_NUMERO_MOVIMENTO>3</M_NUMERO_MOVIMENTO>
				<M_DATA_MOVIMENTO>01/01/2015</M_DATA_MOVIMENTO>
				<M_CODICE_PDCF>3</M_CODICE_PDCF>
				<M_DESCRIZIONE_PDCF>descrizione pdcf</M_DESCRIZIONE_PDCF>
			</movimenti>
		</documentRoot>
	</testStaticData>
	<definitions>
<!-- DEFINIZIONE PARAMETRI DI INPUT -->
 		<metaDato tipoParametro="input">
			<nomeSimbolico>id</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>id della proposta di delibera</descrizione>
			<path/>
		</metaDato>	
<!-- DEFINIZIONE CAMPI DELLA QUERY -->		
		<metaDato>
			<nomeSimbolico>OGGETTO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>oggetto della proposta di delibera</descrizione>
			<path/>
		</metaDato>
        <metaDato>
            <nomeSimbolico>OGGETTO_DEFINITIVO</nomeSimbolico>
            <tipo>string</tipo>
            <descrizione>Oggetto della proposta di delibera alla firma del documento</descrizione>
            <path/>
        </metaDato>
		<metaDato>
			<nomeSimbolico>NUMERO_PROPOSTA</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Numero della proposta di delibera</descrizione>
			<path/>
		</metaDato>		
		<metaDato>
			<nomeSimbolico>ANNO_PROPOSTA</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Anno della proposta di delibera</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>CLASSIFICA_CODICE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Codice della classificazione</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>CLASSIFICA_DESCRIZIONE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Descrizione della classificazione</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>FASCICOLO_NUMERO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Numero del fascicolo</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>FASCICOLO_ANNO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Anno del fascicolo</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>FASCICOLO_OGGETTO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Descrizione del fascicolo</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>FUNZIONARIO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Funzionario della proposta della proposta di delibera</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>DIRIGENTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Nominativo del dirigente della proposta di delibera</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>UNITA_PROPONENTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Unità proponente</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>CODICE_UNITA_PROPONENTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Codice dell'unità proponente</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>SUDDIVISIONE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Suddivisione dell'unita' proponente</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>UNITA_PADRE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Unità padre dell'unità proponente</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>AREA_PROPONENTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Area dell'unita' proponente della proposta di delibera</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>SERVIZIO_PROPONENTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Servizio dell'unita' proponente della proposta di delibera</descrizione>
			<path/>
		</metaDato>		
		<metaDato>
			<nomeSimbolico>FIRMATARIO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Firmatario della proposta di delibera</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>DESCRIZIONE_FIRMATARIO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Indica se il firmatario è un dirigente</descrizione>
			<path/>
		</metaDato>
		<metaDato>
          <nomeSimbolico>DELEGANTE</nomeSimbolico>
          <tipo>string</tipo>
          <descrizione>Indica se il firmatario è stato delegato</descrizione>
          <path/>
        </metaDato>
		<metaDato>
			<nomeSimbolico>DATA_FIRMA</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Data in cui la proposta è stata firmata</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>RELATORE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Relatore della seduta durante la discussione dell'oggetto</descrizione>
			<path/>
		</metaDato>	
		<metaDato>
			<nomeSimbolico>COGNOME_RELATORE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Cognome del relatore della seduta durante la discussione dell'oggetto</descrizione>
			<path/>
		</metaDato>	
		<metaDato>
			<nomeSimbolico>NOME_RELATORE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Nome del relatore della seduta durante la discussione dell'oggetto</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>M_TOTALE_ENTRATE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Somma dei movimenti in entrata</descrizione>
			<path/>
		</metaDato>			
		<metaDato>
			<nomeSimbolico>M_TOTALE_USCITE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Somma dei movimenti in uscita</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>MSE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Il segno della somma delle entrate (+ o -)</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>MSU</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Il segno della somma delle uscite (+ o -)</descrizione>
			<path/>
		</metaDato>

		<!-- Query dei movimenti -->
		<metaDato>
			<nomeSimbolico>M_TIPO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Tipo Movimento</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>M_CAPITOLO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Codice del Capitolo</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>M_ESERCIZIO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Anno di Esercizio</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>M_CIG</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>CIG</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>M_PROGRESSIVO_ESTERNO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Progressio Esterno</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>M_IMPORTO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Importo</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>M_ENTRATA</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Entrata/Spesa</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>M_ESERIZIO_PROVENIENZA</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Esercizio Provenienza Fondi</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>M_NUMERO_MOVIMENTO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Numero Movimento</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>M_DATA_MOVIMENTO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Data Movimento</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>M_CODICE_PDCF</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Codice PDCF</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>M_DESCRIZIONE_PDCF</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Descrizione PDCF</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>REDATTORE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Redattore della proposta di delibera</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>DESCRIZIONE_RADICE_SUDD</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Descrizione dell'unità radice in struttura rispetto l'unità proponente</descrizione>
			<path/>
		</metaDato>
	</definitions>
	<queryes>
 	<!-- proposta_delibera: restituisce i dati di una proposta di delibera -->
 	<query id='proposta_delibera'
		   help_query_alias="p"
		   help_field_aliases="ANNO_PROPOSTA, AREA_PROPONENTE, CLASSIFICA_CODICE, CLASSIFICA_DESCRIZIONE, CODICE_UNITA_PROPONENTE, COGNOME_RELATORE, DATA_FIRMA, DIRIGENTE, FASCICOLO_ANNO, FASCICOLO_NUMERO, FASCICOLO_DESCRIZIONE, FIRMATARIO, FUNZIONARIO, NOME_RELATORE, NUMERO_PROPOSTA, OGGETTO, OGGETTO_DEFINITIVO, RELATORE, SERVIZIO_PROPONENTE, SUDDIVISIONE, UNITA_PADRE, UNITA_PROPONENTE, M_TOTALE_ENTRATE, M_TOTALE_USCITE, MSE, MSU, REDATTORE, DESCRIZIONE_FIRMATARIO, DELEGANTE, DESCRIZIONE_RADICE_SUDD">
 select oggetto OGGETTO
     , decode (f.data_firma, null, '${documentRoot.proposta_delibera.OGGETTO_DEFINITIVO}', oggetto) OGGETTO_DEFINITIVO
     , decode(numero_proposta, null, '${documentRoot.proposta_delibera.NUMERO_PROPOSTA}', numero_proposta) NUMERO_PROPOSTA
     , decode(anno_proposta, null, '${documentRoot.proposta_delibera.ANNO_PROPOSTA}', anno_proposta) ANNO_PROPOSTA
     , decode(classifica_codice, null, '${documentRoot.proposta_delibera.CLASSIFICA_CODICE}', classifica_codice) CLASSIFICA_CODICE
     , decode(classifica_descrizione, null, '${documentRoot.proposta_delibera.CLASSIFICA_DESCRIZIONE}', classifica_descrizione) CLASSIFICA_DESCRIZIONE
     , decode(fascicolo_anno, null, '${documentRoot.proposta_delibera.FASCICOLO_ANNO}', fascicolo_anno) FASCICOLO_ANNO
     , decode(fascicolo_numero, null, '${documentRoot.proposta_delibera.FASCICOLO_NUMERO}', fascicolo_numero) FASCICOLO_NUMERO
     , decode(fascicolo_oggetto, null, '${documentRoot.proposta_delibera.FASCICOLO_OGGETTO}', fascicolo_oggetto) FASCICOLO_OGGETTO
     , decode(pd.controllo_funzionario,'N',null, utility_pkg.get_nominativo_sogg_prop_deli (pd.id_proposta_delibera, 'FUNZIONARIO')) FUNZIONARIO
     , utility_pkg.get_nominativo_sogg_prop_deli (pd.id_proposta_delibera, 'DIRIGENTE') DIRIGENTE
     , utility_pkg.get_unita_prop_delibera (pd.id_proposta_delibera) UNITA_PROPONENTE 
     , utility_pkg.get_codice_unita_prop_delibera(pd.id_proposta_delibera) CODICE_UNITA_PROPONENTE  
     , utility_pkg.get_suddivisione_uo_prop_deli (pd.id_proposta_delibera) SUDDIVISIONE
     , utility_pkg.get_uo_padre_prop_delibera (pd.id_proposta_delibera) UNITA_PADRE
     , utility_pkg.get_suddivisione_prop_delibera (pd.id_proposta_delibera, 'SO4_SUDDIVISIONE_AREA', pd.ente) AREA_PROPONENTE
     , utility_pkg.get_suddivisione_prop_delibera (pd.id_proposta_delibera, 'SO4_SUDDIVISIONE_SERVIZIO', pd.ente) SERVIZIO_PROPONENTE                                                          
     , nvl (utility_pkg.get_nominativo_soggetto (utility_pkg.get_ni_soggetto (nvl(f.utente_firmatario_effettivo, f.utente_firmatario)), pd.ente), '${documentRoot.proposta_delibera.FIRMATARIO}') FIRMATARIO
     , decode(nvl(f.utente_firmatario_effettivo, f.utente_firmatario),null,'${documentRoot.proposta_delibera.DESCRIZIONE_FIRMATARIO}', utility_pkg.get_descrizione_firmatario(nvl(f.utente_firmatario_effettivo, f.utente_firmatario), pd.ente)) DESCRIZIONE_FIRMATARIO
     , decode(nvl(f.utente_firmatario_effettivo, f.utente_firmatario),null,'${documentRoot.proposta_delibera.DELEGANTE}', utility_pkg.get_delegante(f.utente_firmatario_effettivo, f.utente_firmatario, pd.ente)) DELEGANTE
     , nvl (to_char (f.data_firma, 'dd/mm/yyyy'), '${documentRoot.proposta_delibera.DATA_FIRMA}') DATA_FIRMA
     , utility_pkg.get_cognome_nome(deleghe.ni_assessore) RELATORE
     , InitCap(utility_pkg.get_cognome(deleghe.ni_assessore)) COGNOME_RELATORE
     , InitCap(utility_pkg.get_nome(deleghe.ni_assessore)) NOME_RELATORE
	 , (select trim(TO_CHAR(abs(sum(m.importo)),       '999G999G999G990D99', 'NLS_NUMERIC_CHARACTERS = '',.''')) from movimenti_contabili m where m.tipo = 'ENTRATA' and m.id_documento = pd.id_proposta_delibera and m.tipo_documento = 'PROPOSTA_DELIBERA') M_TOTALE_ENTRATE
     , (select trim(TO_CHAR(abs(sum(m.importo)),       '999G999G999G990D99', 'NLS_NUMERIC_CHARACTERS = '',.''')) from movimenti_contabili m where m.tipo = 'USCITA'  and m.id_documento = pd.id_proposta_delibera and m.tipo_documento = 'PROPOSTA_DELIBERA') M_TOTALE_USCITE
     , (select decode(sign(sum(m.importo)), -1, '-', '+') from movimenti_contabili m where m.tipo = 'ENTRATA' and m.id_documento = pd.id_proposta_delibera and m.tipo_documento = 'PROPOSTA_DELIBERA') MSE
     , (select decode(sign(sum(m.importo)), -1, '-', '+') from movimenti_contabili m where m.tipo = 'USCITA'  and m.id_documento = pd.id_proposta_delibera and m.tipo_documento = 'PROPOSTA_DELIBERA') MSU	 
     , utility_pkg.get_nominativo_sogg_prop_deli (pd.id_proposta_delibera, 'REDATTORE') REDATTORE
	 , utility_pkg.unita_get_radice_prop_delibera (pd.id_proposta_delibera) DESCRIZIONE_RADICE_SUDD
  from proposte_delibera pd
     ,  firmatari f
     ,  deleghe
 where pd.id_proposta_delibera = #id
   and f.id_proposta_delibera(+) = pd.id_proposta_delibera
   and f.firmato(+) = 'N'
   and f.data_firma(+) is not null
   and pd.id_delega = deleghe.id_delega(+) 
 </query>
 <query id="movimenti"
        help_query_alias="m"
		help_field_aliases="M_TIPO, M_ESERCIZIO, M_PROGRESSIVO_ESTERNO, M_CAPITOLO, M_ENTRATA, M_CIG, M_ESERIZIO_PROVENIENZA, M_IMPORTO, M_NUMERO_MOVIMENTO, M_DATA_MOVIMENTO, M_CODICE_PDCF, M_DESCRIZIONE_PDCF">
			select m.tipo_Dettaglio AS M_TIPO,
					m.anno_Esercizio AS M_ESERCIZIO,
					m.capitolo AS M_CAPITOLO,
					m.PROGRESSIVO_Esterno AS M_PROGRESSIVO_ESTERNO,
					decode(m.tipo, 'ENTRATA', 'E', 'S') AS M_ENTRATA,
					m.CIG AS M_CIG,
					m.esercizio_Esterno AS M_ESERIZIO_PROVENIENZA,
					trim(TO_CHAR(m.importo, '999G999G999G990D99', 'NLS_NUMERIC_CHARACTERS = '',.''')) AS M_IMPORTO,
					m.numero_Movimento AS M_NUMERO_MOVIMENTO,
					decode(m.DATA_MOVIMENTO, null, '', to_char (m.data_Movimento, 'dd/mm/yyyy')) AS M_DATA_MOVIMENTO,
					m.codice_Pdcf AS M_CODICE_PDCF,
					m.descrizione_Pdcf AS M_DESCRIZIONE_PDCF
		  from movimenti_contabili m
		 where m.id_documento   = #id
		   and m.tipo_documento = 'PROPOSTA_DELIBERA'
		 order by m.tipo asc
 </query>
  	</queryes>
	<staticData />
</documentRoot>