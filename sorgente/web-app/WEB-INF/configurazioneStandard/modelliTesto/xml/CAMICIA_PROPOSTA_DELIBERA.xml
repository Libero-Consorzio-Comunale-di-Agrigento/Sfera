<?xml version="1.0" encoding="utf-8"?>
<documentRoot>
	<descrizione>Camicia della Proposta di Delibera</descrizione>
	<connections>
		<connectionJNDI>jdbc/agsde2</connectionJNDI>
	</connections>
	<testStaticData>
		<documentRoot>
			<proposta_delibera>
				<ANNO_PROPOSTA>2014</ANNO_PROPOSTA>
				<NUMERO_PROPOSTA>10</NUMERO_PROPOSTA>
				<OGGETTO>PROPOSTA DI DELIBERA</OGGETTO>
				<CLASSIFICA_CODICE>01</CLASSIFICA_CODICE>
				<CLASSIFICA_DESCRIZIONE>DESCRIZIONE TITOLARIO</CLASSIFICA_DESCRIZIONE>
				<FASCICOLO_ANNO>2014</FASCICOLO_ANNO>
				<FASCICOLO_NUMERO>100</FASCICOLO_NUMERO>
				<FASCICOLO_OGGETTO>DESCRIZIONE FASCICOLO</FASCICOLO_OGGETTO>
				<DIRIGENTE>TRABUCCHI LAURA</DIRIGENTE>
				<UNITA_PROPONENTE>AREA AFFARI GENERALI</UNITA_PROPONENTE>
				<UNITA_PADRE>AREA AMMINISTRATIVA</UNITA_PADRE>
				<CODICE_UNITA_PROPONENTE>A_AAGG</CODICE_UNITA_PROPONENTE>
				<AREA_PROPONENTE>AFFARI GENERALI</AREA_PROPONENTE>
				<SERVIZIO_PROPONENTE>SEGRETERIA</SERVIZIO_PROPONENTE>						
				<SUDDIVISIONE>AREA</SUDDIVISIONE>
				<FUNZIONARIO>NOMINATIVO FUNZIONARIO</FUNZIONARIO>
				<FIRMATARIO>NOMINATIVO FIRMATARIO</FIRMATARIO>
				<DATA_FIRMA>01/05/2014</DATA_FIRMA>
				<COGNOME_RELATORE>COGNOME RELATORE</COGNOME_RELATORE>
				<NOME_RELATORE>NOME RELATORE</NOME_RELATORE>
				<RELATORE>NOMINATIVO RELATORE</RELATORE>
				<DATA_SEDUTA>04/04/2016</DATA_SEDUTA>
				<SEGRETARIO>NOMINATIVO SEGRETARIO</SEGRETARIO>
			</proposta_delibera>
			<partecipanti>
				<PARTECIPANTE>PRIMO PARTECIPANTE</PARTECIPANTE>
				<INCARICO_PARTECIPANTE>INCARICO PRIMO PARTECIPANTE</INCARICO_PARTECIPANTE>
				<PRESENTE_ASSENTE>Assente</PRESENTE_ASSENTE>
				<PRESENTE_ASSENTE_OGGETTO>Presente</PRESENTE_ASSENTE_OGGETTO>
			</partecipanti>
			<partecipanti>
				<PARTECIPANTE>SECONDO PARTECIPANTE</PARTECIPANTE>
				<INCARICO_PARTECIPANTE>INCARICO SECONDO PARTECIPANTE</INCARICO_PARTECIPANTE>
				<PRESENTE_ASSENTE>Assente</PRESENTE_ASSENTE>
				<PRESENTE_ASSENTE_OGGETTO>Presente</PRESENTE_ASSENTE_OGGETTO>
			</partecipanti>
			<partecipanti>
				<PARTECIPANTE>TERZO PARTECIPANTE</PARTECIPANTE>
				<INCARICO_PARTECIPANTE>INCARICO TERZO PARTECIPANTE</INCARICO_PARTECIPANTE>
				<PRESENTE_ASSENTE>Assente</PRESENTE_ASSENTE>
				<PRESENTE_ASSENTE_OGGETTO>Assente</PRESENTE_ASSENTE_OGGETTO>
			</partecipanti>
			<partecipanti>
				<PARTECIPANTE>QUARTO PARTECIPANTE</PARTECIPANTE>
				<INCARICO_PARTECIPANTE>INCARICO QUARTO PARTECIPANTE</INCARICO_PARTECIPANTE>
				<PRESENTE_ASSENTE>Assente</PRESENTE_ASSENTE>
				<PRESENTE_ASSENTE_OGGETTO>Presente</PRESENTE_ASSENTE_OGGETTO>
			</partecipanti>
			<componenti>
				<COMPONENTE>PRIMO COMPONENTE</COMPONENTE>
				<INCARICO>INCARICO PRIMO COMPONENTE</INCARICO>
			</componenti>
			<componenti>
				<COMPONENTE>SECONDO COMPONENTE</COMPONENTE>
				<INCARICO>INCARICO SECONDO COMPONENTE</INCARICO>
			</componenti>
			<componenti>
				<COMPONENTE>TERZO COMPONENTE</COMPONENTE>
				<INCARICO>INCARICO TERZO COMPONENTE</INCARICO>
			</componenti>
			<componenti>
				<COMPONENTE>QUARTO COMPONENTE</COMPONENTE>
				<INCARICO>INCARICO QUARTO COMPONENTE</INCARICO>
			</componenti>
		</documentRoot>
	</testStaticData>
	<definitions>
<!-- DEFINIZIONE PARAMETRI DI INPUT -->
 		<metaDato tipoParametro="input">
			<nomeSimbolico>id</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>id della delibera</descrizione>
			<path/>			
		</metaDato>
<!-- CAMPI DELLA QUERY PROPOSTA_DELIBERA -->		
		<metaDato>
			<nomeSimbolico>OGGETTO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>oggetto della proposta di delibera</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>NUMERO_PROPOSTA</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Numero della proposta di delibera</descrizione>
			<path/>
		</metaDato>		
		<metaDato>
			<nomeSimbolico>ANNO_PROPOSTA</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Anno della proposta di delibera</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>CLASSIFICA_CODICE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Codice della classificazione</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>CLASSIFICA_DESCRIZIONE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Descrizione della classificazione</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>FASCICOLO_NUMERO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Numero del fascicolo</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>FASCICOLO_ANNO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Anno del fascicolo</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>FASCICOLO_OGGETTO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Descrizione del fascicolo</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>FUNZIONARIO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Funzionario della proposta di delibera</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>DIRIGENTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Nominativo del dirigente della proposta di delibera</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>UNITA_PROPONENTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Unità proponente</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>CODICE_UNITA_PROPONENTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Codice dell'unità proponente</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>SUDDIVISIONE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Suddivisione dell'unita' proponente</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>UNITA_PADRE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Unità padre dell'unità proponente</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>AREA_PROPONENTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Area dell'unita' proponente della proposta di delibera</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>SERVIZIO_PROPONENTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Servizio dell'unita' proponente della proposta di delibera</descrizione>
			<path/>
		</metaDato>		
		<metaDato>
			<nomeSimbolico>FIRMATARIO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Firmatario della proposta di delibera</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>DATA_FIRMA</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Data in cui la proposta è stata firmata</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>RELATORE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Relatore della seduta durante la discussione dell'oggetto</descrizione>
			<path/>
		</metaDato>	
		<metaDato>
			<nomeSimbolico>COGNOME_RELATORE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Cognome del relatore della seduta durante la discussione dell'oggetto</descrizione>
			<path/>
		</metaDato>	
		<metaDato>
			<nomeSimbolico>NOME_RELATORE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Nome del relatore della seduta durante la discussione dell'oggetto</descrizione>
			<path/>
		</metaDato>	
		<metaDato>
			<nomeSimbolico>DATA_SEDUTA</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Data della Seduta</descrizione>
			<path/>
		</metaDato>	
		<metaDato>
			<nomeSimbolico>SEGRETARIO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Cognome e Nome del Segretario della Seduta</descrizione>
			<path/>
		</metaDato>	
	
<!-- CAMPI DELLA QUERY PARTECIPANTI -->
		<metaDato>
			<nomeSimbolico>PARTECIPANTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Nome del partecipante</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>INCARICO_PARTECIPANTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Incarico del partecipante</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>PRESENTE_ASSENTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Presenza/assenza del partecipante all'appello della seduta</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>PRESENTE_ASSENTE_OGGETTO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Presenza/assenza del partecipante alla discussione della proposta</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>COMPONENTE</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Nome del componente</descrizione>
			<path/>
		</metaDato>
		<metaDato>
			<nomeSimbolico>INCARICO</nomeSimbolico>
			<tipo>string</tipo>
			<descrizione>Incarico del componente</descrizione>
			<path/>
		</metaDato>
	</definitions>
	<queryes>
		<!-- proposta_delibera: restituisce i dati di una proposta di delibera -->
 	<query id='proposta_delibera'
		   help_query_alias="p"
		   help_field_aliases="ANNO_PROPOSTA, AREA_PROPONENTE, CLASSIFICA_CODICE, CLASSIFICA_DESCRIZIONE, CODICE_UNITA_PROPONENTE, COGNOME_RELATORE, DATA_FIRMA, DIRIGENTE, FASCICOLO_ANNO, FASCICOLO_NUMERO, FASCICOLO_DESCRIZIONE, FIRMATARIO, FUNZIONARIO, NOME_RELATORE, NUMERO_PROPOSTA, OGGETTO, RELATORE, SERVIZIO_PROPONENTE, SUDDIVISIONE, UNITA_PADRE, UNITA_PROPONENTE, DATA_SEDUTA, SEGRETARIO">
 select oggetto OGGETTO
     , numero_proposta NUMERO_PROPOSTA
     , anno_proposta ANNO_PROPOSTA
     , classifica_codice CLASSIFICA_CODICE
     , classifica_descrizione CLASSIFICA_DESCRIZIONE
     , fascicolo_anno FASCICOLO_ANNO
     , fascicolo_numero FASCICOLO_NUMERO
     ,fascicolo_oggetto FASCICOLO_OGGETTO
     , decode(pd.controllo_funzionario,'N',null, utility_pkg.get_nominativo_sogg_prop_deli (pd.id_proposta_delibera, 'FUNZIONARIO')) FUNZIONARIO
     , utility_pkg.get_nominativo_sogg_prop_deli (pd.id_proposta_delibera, 'DIRIGENTE') DIRIGENTE
     , utility_pkg.get_unita_prop_delibera (pd.id_proposta_delibera) UNITA_PROPONENTE
     , utility_pkg.get_codice_unita_prop_delibera(pd.id_proposta_delibera) CODICE_UNITA_PROPONENTE
     , utility_pkg.get_suddivisione_uo_prop_deli (pd.id_proposta_delibera) SUDDIVISIONE
     , utility_pkg.get_uo_padre_prop_delibera (pd.id_proposta_delibera) UNITA_PADRE
     , utility_pkg.get_suddivisione_prop_delibera (pd.id_proposta_delibera, 'SO4_SUDDIVISIONE_AREA', pd.ente) AREA_PROPONENTE
     , utility_pkg.get_suddivisione_prop_delibera (pd.id_proposta_delibera, 'SO4_SUDDIVISIONE_SERVIZIO', pd.ente) SERVIZIO_PROPONENTE
     , utility_pkg.get_cognome_nome(deleghe.ni_assessore) RELATORE
     , InitCap(utility_pkg.get_cognome(deleghe.ni_assessore)) COGNOME_RELATORE
     , InitCap(utility_pkg.get_nome(deleghe.ni_assessore)) NOME_RELATORE
     , to_char (os.data_seduta, 'dd/mm/yyyy') DATA_SEDUTA
     , (select (utility_pkg.get_cognome_nome(nvl(occ.ni_componente, osp.ni_componente_esterno)))
               from odg_sedute_partecipanti osp
                  , odg_commissioni_componenti occ
                  , odg_incarichi i
                  , odg_incarichi i_osp
              where osp.id_seduta = os.id_seduta
                and occ.id_commissione_componente(+) = osp.id_commissione_componente
                and i.id_incarico(+) = occ.id_incarico
                and i_osp.id_incarico(+) = osp.id_incarico
                and osp.ruolo_partecipante = 'S'
                and osp.presente = 'Y') SEGRETARIO
  from proposte_delibera pd
     , deleghe
     , odg_oggetti_seduta oos
     , odg_sedute os
 where pd.id_delega = deleghe.id_delega(+)
   and pd.id_oggetto_seduta = oos.id_oggetto_seduta(+)
   and oos.id_seduta = os.id_seduta(+)
   and pd.id_proposta_delibera = #id
 </query>
		<query id='partecipanti'
			   help_query_alias="p"
		       help_field_aliases="INCARICO_PARTECIPANTE, PARTECIPANTE, PRESENTE_ASSENTE, PRESENTE_ASSENTE_OGGETTO">
  select decode (osp.id_commissione_componente, null, utility_pkg.get_cognome_nome(osp.ni_componente_esterno), utility_pkg.get_cognome_nome(occ.ni_componente))  PARTECIPANTE
       , nvl (i_osp.titolo, i.titolo) INCARICO_PARTECIPANTE
       , decode (osp.presente, 'Y', 'Presente', 'Assente') PRESENTE_ASSENTE
       , decode (oop.presente, 'Y', 'Presente', 'Assente') PRESENTE_ASSENTE_OGGETTO
    from odg_oggetti_partecipanti oop
       , odg_sedute_partecipanti osp
       , odg_oggetti_seduta oos
	   , odg_sedute os
       , odg_commissioni_componenti occ
       , odg_incarichi i
       , odg_incarichi i_osp
   where oos.id_proposta_delibera = #id
     and oos.id_oggetto_seduta = oop.id_oggetto_seduta
	 and oos.id_seduta = os.id_seduta
     and oop.id_seduta_partecipante = osp.id_seduta_partecipante
     and occ.id_commissione_componente(+) = osp.id_commissione_componente
     and nvl (oop.ruolo_partecipante, 'J') not in ('S', 'I')
	 and not(nvl (oop.ruolo_partecipante, 'J') in ('P') and os.voto_presidente = 'N')
     and i.id_incarico(+) = occ.id_incarico
     and i_osp.id_incarico(+) = osp.id_incarico
order by occ.sequenza, utility_pkg.get_cognome_nome(occ.ni_componente), utility_pkg.get_cognome_nome(osp.ni_componente_esterno) asc 
 		</query>
		<query id='componenti'
			   help_query_alias="c"
		       help_field_aliases="INCARICO, COMPONENTE">
  select utility_pkg.get_cognome_nome(occ.ni_componente)  COMPONENTE
       , i.titolo INCARICO
    from odg_commissioni_componenti occ
       , odg_incarichi i
       , proposte_delibera p
   where p.id_proposta_delibera = #id
     and occ.id_commissione = p.id_commissione
     and occ.valido = 'Y'
     and i.id_incarico = occ.id_incarico
order by occ.sequenza, utility_pkg.get_cognome_nome(occ.ni_componente) asc
		</query>
	</queryes>
	<staticData />
</documentRoot>